# Firestore Data Model for AlphaFlow (Guided Mode User Data)

This document outlines the Firestore data structure for storing user-specific data related to the Guided Mode, assuming Level & Task definitions remain in the app bundle (`guided_tracks.dart`).

## 1. Collection: `users`

*   **Document ID:** `{userID}` (This will come from Firebase Anonymous Authentication)
    *   **Field:** `firstActiveDate`
        *   **Type:** `Timestamp` (Firestore Timestamp)
        *   **Description:** Stores the first date the user actively used the app (e.g., after mode selection). Normalized to YYYY-MM-DD UTC.
    *   **Field:** `selectedTrackId`
        *   **Type:** `String` (nullable)
        *   **Description:** The ID of the currently selected guided track.
    *   **Field:** `appMode`
        *   **Type:** `String` (e.g., "guided", "custom")
        *   **Description:** The current app mode. (Consider if this is truly needed in Firestore vs. SharedPreferences for client-side logic).
    *   **Map Field:** `trackProgress`
        *   **Type:** `Map<String, Map<String, dynamic>>`
        *   **Description:** Stores progress for each track the user has engaged with.
        *   **Structure (for each `trackID` key):**
            *   `totalXP`: `Number` (Integer) - Total XP accumulated for this track.
            *   `currentLevelNumber`: `Number` (Integer) - The current level number the user is on for this track.
            *   `achievedDate`: `Timestamp` (Optional) - When this level was first achieved.


## 2. Subcollection under `users/{userID}`: `taskCompletions`

*   **Document ID:** Auto-generated by Firestore
    *   **Field:** `taskId`
        *   **Type:** `String`
        *   **Description:** The ID of the completed task (links to a task in `guided_tracks.dart`).
    *   **Field:** `date`
        *   **Type:** `Timestamp` (Firestore Timestamp)
        *   **Description:** The date for which the task was completed (normalized to YYYY-MM-DD UTC).
    *   **Field:** `trackId`
        *   **Type:** `String` (nullable)
        *   **Description:** The ID of the track this task belongs to.
    *   **Field:** `xpAwarded`
        *   **Type:** `Number` (Integer)
        *   **Description:** XP value of the task at the time of completion (useful if task XP values could ever change, or for auditing).

## Rationale / Notes:

*   **User-Specific Data:** All data is namespaced under the unique `userID`.
*   **Static Definitions Local:** Level structures, task details (titles, descriptions, XP values, frequencies) are defined in `guided_tracks.dart` within the app bundle to minimize Firestore reads and costs. Firestore stores references (like `taskId`, `currentLevelNumber`) to this local data.
*   **Denormalization for Performance:** `trackProgress` stores `totalXP` and `currentLevelNumber` directly in the user document to avoid costly recalculations from all `taskCompletions` on every app load or profile view. The client application will be responsible for updating these denormalized fields when new tasks are completed.
*   **Timestamp Normalization:** Dates (like `firstActiveDate` and `taskCompletions.date`) should be stored normalized to midnight UTC (YYYY-MM-DD) to ensure consistent querying across timezones.
